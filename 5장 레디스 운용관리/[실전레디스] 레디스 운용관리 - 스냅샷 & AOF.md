## Redis 데이터 영속성(Persistence)에 대한 이해와 운영관리 관점의 접근

Redis는 대표적인 인메모리 데이터 저장소로, 빠른 응답성과 높은 처리량을 강점으로 갖고 있습니다. 하지만 그 특성상 **서버가 종료되거나 장애가 발생하면 메모리에 존재하던 데이터가 모두 유실될 수 있다는 단점**도 내포하고 있습니다. 이를 보완하기 위해 Redis는 **데이터 영속성(Persistence)** 기능을 제공하며, 이는 **운영관리 측면에서 서비스의 안정성과 신뢰성을 확보하는 데 매우 중요한 요소**입니다.

Redis는 두 가지 방식의 영속성 메커니즘을 지원합니다. 각각의 방식은 장단점이 뚜렷하므로, 서비스 특성과 운영 전략에 따라 적절히 선택하거나 병행하여 사용하는 것이 중요합니다.

# 데이터 영속성 관리

## 1. RDB 스냅샷 (Redis Database Snapshot)

**RDB 방식은 메모리의 데이터를 일정 시점에 스냅샷으로 저장**하는 방식입니다. Redis는 설정된 조건(`save` 명령)이나 수동 명령(`BGSAVE`)에 따라메모리의 데이터를 `.rdb` 파일로 디스크에 덤프합니다.

### 운영관리 관점에서의 특징

- **시점 복구**가 가능하여 빠르게 서비스를 복원할 수 있음
- 덤프 주기 사이의 변경사항은 유실될 수 있으므로 **완벽한 실시간 복구에는 적합하지 않음**
- **성능에 거의 영향을 주지 않으며**, 주기적인 백업 파일을 생성해 둘 수 있어 **장애 복구 시 유용**

### 예시 설정

```bash
save 900 1
save 300 10
save 60 10000m
```

## 2. AOF (Append Only File)

**AOF는 Redis에서 발생하는 모든 쓰기(write) 명령을 로그로 기록하는 방식**입니다. 이 파일을 기반으로 Redis는 재시작 시 모든 명령을 다시 실행하여 상태를 복원합니다.

### 운영관리 관점에서의 특징

- **데이터 유실 가능성이 거의 없음** (기본 설정 기준으로 1초 내)
- **장애 발생 직전까지의 데이터 복구가 가능**하다는 점에서 실시간성이 중요시되는 서비스에 적합
- 명령어를 누적 기록하기 때문에 파일 크기가 커지며, 이에 따라 **AOF Rewrite**와 같은 주기적 압축 작업이 필요

### 파일 동기화 설정 옵션

```bash
appendonly yes
appendfsync everysec  # 기본 설정, 안정성과 성능의 균형
```

## 3. RDB와 AOF의 병행 사용

Redis 4.0 이상부터는 **RDB와 AOF를 동시에 활성화할 수 있으며**, Redis는 장애 발생 시 AOF 파일을 우선하여 복구를 시도합니다. 이 방식은 **스냅샷 기반의 빠른 복구성과 명령 로그 기반의 데이터 정확성**을 동시에 확보할 수 있다는 장점이 있습니다.

### 운영 전략 예시

- RDB: 정기 백업 및 이중화 서버 간 데이터 복제 목적
- AOF: 실시간 복구 및 서비스 무정지 장애 복구 대응

## 4. 데이터 영속성 옵션은 옳은가?

Redis의 가장 큰 장점은 메모리 기반 구조를 활용한 **빠른 처리 속도**입니다. 따라서 영속성 옵션을 활성화한다는 것은 **그 장점을 일정 부분 희생하는 선택**이기도 합니다. 실제로 AOF 방식과 같은 로그 기록 방식은 I/O 부하를 유발하여 성능 저하로 이어질 수 있습니다.

즉, **데이터 영속성은 처리 속도와 안정성 사이의 트레이드 오프**로 이해해야 합니다. 이러한 옵션은 반드시 필요한 경우에만 신중히 활성화해야 합니다. 예를 들어, 다음과 같은 상황에서는 영속성 옵션을 고려할 수 있습니다.

- **데이터가 비즈니스 로직상 반드시 복원되어야 할 필요가 있는 경우**
- **Redis 장애 발생 시, 전체 시스템의 복구 시간이 치명적으로 오래 걸리는 경우**
- **캐시 이상의 역할을 수행하며, 일시적 유실조차 허용되지 않는 경우**

결론적으로, Redis의 영속성 기능은 모든 상황에서 무조건 켜야 하는 설정이 아니라, **서비스의 특성과 운영 리스크를 면밀히 분석한 후 선택적으로 적용해야 하는 기능**입니다.
